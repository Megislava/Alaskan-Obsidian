#### Sitova vs linkova vrstva
- linkova
	- prenos dat mezi sousednimi zarizenimi, rizeni toku, kontrola chyb
	- kontrola pristupu k mediu
- sitova
	- prenos dat mezi zdrojem a cilem, adresy sitovych mist
	- smerovani mezi sitemi
	- sluzby ruzne kvality

- sluzby sitove vrstvy
	- pro transportni vrstvu:
		- nezavislost na zpusobu smerovani, nezavislost na topologii site, jednoznacna cislovaci schema
	- zaruka doruceni, doruceni v poradi, zaruka sirky pasma, omezene zpozdeni

#### Modely
1. spojovana sit - connection-oriented
	- virtualni okruhy
		- nejdrive se sestavi cesta (info o ceste ve smerovacich)
		- vsechna data jednoho spojeni prenasena ohruhem
		- cesta (virtualni okruh) se po prenosu zrusi (vymazani informace z tabulek ve smerovacich)
	- hlavicka paketu obsahuje cislo virtualniho okruhu (cesty)
	- nezbytne pouziti smerovaci tabulky
	- napr: MPLS, ATM
1. nespojovana sit - connectionless
	- spojeni je realizovano v transportni vrstve
	- blok dat rozdelen na pakety
	- koncove zarizeni muze: SEND a RECEIVE PACKET
	- pakety
		- smerovany individualne
		- hlavicka obsahuje cilovou adresu
	- na smerovani se vyuziva smerovaci algoritmus
		- vetsinou se vyuziva smerovaci tabulka
	- napr: IP

#### Adresace
- unikatni adresy v cele siti
- sit
	- souvisla skupina adres, rozdeleni adresniho prostoru, zjednoduseni smerovani
	- viceurovnove usporadani
- zpusoby
	- unicast
		- zasilani paketu jednomu prijemci (adresa je v cele siti unikatni)
		- standartni v IPv4 i IPv6 (tridy adres A, B, C)
	- broadcast
		- zasilani vsem v lokalni siti (neroutuje se mimo lokalni sit)
		- adresa interface vetsinou obsahuje same "1"
	- anycast
		- existuje nekolik zarizeni se stejnou adresou ale skutecny prijemce je jedno zarizeni v ramci skupiny
		- standartne v IPv6, vyjimecne v IPv4
			- DNS "root nameservers", "content delivery networks"
	- multicast
		- zasilani paketu skupine koncovych prijemcu
		- vyhrazene adresu v IPv4 - class D
		- protokol IGMP (registruje ucastniky)
			- smerovaci protokol PIM (dense, sparse)
- IPv4
	- 32-bitove cislo
		- 4 skupiny po 8 butech (oktetech)
	- tridy - uz se nepouzivaji
		- A, B, C - normalni adresy (unicast)
		- D - multicast
		- E - rezervovano
	- CIDR schema (Classless Inter-Domain Routing)
		- delka sitoveho prefixu je libovolna
		- zruseni trid A, B, C
		- zapis masky pomoci poctu bitu sitove casti
		- ![[Pasted image 20230320141230.png]]
	- privatni adresy
		- vyhrazene sitove adresy - volne k dispozici
		- neroutuji se po internetu
		- typicky vyuzitejne pro NAT 
			- resi nedostatek verejnych IP adres, usnadnuje izolaci privatnich siti, smerovac preklada privatni adresy an jednu verejnou
	- hlavicka
		- version (4 - IPv4), header length, type of service (napr: QoS),total length, identification (ID packetu - pro fragmentaci), flags, fragment offset
		- time to live (TTL, citac pruchodu smerovaci)
		- protocol, header checksum (kontrola integrity headeru)
		- source address, destination address
		- options, padding (zarovnani na delku 32 bitu)
	- fragmentace
		- paket nemuze byt libovolne velky
			- maximalni delka ramce = MTU (maximum transmission unit)
				- definovano linkovou vrstvou, typicky 1500 bytu
				- vyssi MTU redukuje overhead, nizsi snizuje transportni zpozdeni
		- rozdeleni paketu na kratsi dle potrebu
			- dorucovany nezavisle, sestaveni az na cilovem zarizeni
- IPv6
	- 8 skupin po 4 hexa cislech
		- oddelovac `:`, pokud `::` pak jsou tam 0
		- posledni 4 byty jde napsat dekadicky (kompatibilita s IPv4)
		- ![[Pasted image 20230320151737.png]]
			- stejna adresa
		- ::1/128 - loopback (obdoba 127.0.0.1)
		- fc00::/7 - individualni lokalni adresy (obdoba privatnich adres)
		- fe80::/10 - lokalni linkove adresy (obdoba 169.254.0.0/16)
		- ff00::/8 - skupinove adresy (multicast)
		- 2001:db8::/32 - v prikladech a dokumentaci
		- individualni globalni adresy definuje RFC3587
			- zatim speficikovan prefix 2000::/3
	- classful design neefektivni, CIDR nevyresil problemy s nedostatkem IP adres, vycerpani adresniho prostoru => vznik nove IP specifikace
	- pozadavky:
		- vetsi adresni prostor, automaticka konfigurace (eliminace DHCP), podpora QoS, vetsi bezpecnost, mobilita
	- header
		- version (6 - IPv6), traffic class (8b, trida provozu), flow label, payload length (16b), next header (8b, typ nasledujici hlavicky/dat), hop limit (obdoba TTL, maximalni pocet skoku, ochrana proti zacykleni)
		- source address, destination address
			- 128-bitu (4x delsi adresa)
		- ![[Pasted image 20230320150528.png]]
			- chybi fragmentace, options, delka headeru, control sum
			- navic flow label - identifikace datoveho toku (usnadneni smerovani, neni specifikovano)
		- za zakladni hlavickou muzou byt rozsirujici hlavicky
			- poradi je pevne
			- typy: 0 (volba pro vsechny), 43 (smerovani), 44 (fragmentace), 50 (sifrovani), 51 (autentizace), 60 (volby pro cil), 135 (mobilita),...
	- obsah next header - 6 (TCP), 8 (EGP), 9 (IGP), 17 (UDP), 46 (RVSP), 47 (GRE), 58 (ICMP pro IPv6)
	- jumbogram
		- puvodne: max delka paketu je 65535 (2^16 - 1)
		- IPv6 jumbogram - velikost az 4Gb
			- ma smysl pro MTU > 64Kb, payload length nastaven na 0
	- fragmentace
		- minimalni MTU pro IPv6 je 1280 bytu
		- provadi ji odesilatel
		- pokud je paket moc dlouhy
			- smerovac ho zahodi, odesle odesilateli ICMP zpravu s informaci o MTU
			- snaha o vylouceni fragmantace, nastaveni velikosti fatagramu na MTU
	- typy
		- unicast - individualni
		- multicast - skupinove
		- anycast - vyberove
	- sitove rozhrani ma vice adres IPv6
		- lokalni linkova, loopback, individualni a vyberova, skupinova pro vsechny uzly, skupinova pro skupiny jejichz je clenem, skupinova pro vyzyvany uzel
	- smerovac ma navic adresy
		- skupinova pro vsechny smerovace, vyberova pro vsechny smerovace, vsechny pridelene vyberove adresy
	- NDP
		- Neighbor Discovery Protocol (nahrada ARP, vyuziva ICMPv6)
		- umoznuje: zjistovani linkovych adres v lokalni siti, rychlou aktualizaci zmen a neplatnych polozek, hledani smerovacu, presmerovani, detekci duplikovanych adres, overovani dosazitelnosti sousedu, zjistovani udaji pro automatickou konfiguraci
	- 

#### Protokoly vrstvy
- ICMP
	- Internet Control Message Protocol
	- chybove spravy site posilane puvodnimu odesilateli
	- 0 (reply, ping), 8 (request), 3 (unreachable), 11 (timeout dle TTL)
- ARP
	- Address Resolution Protocol
	- mapovani mezi sitovou adresou (napr IP) a HW adresou (napr MAC)
		- "Who is XXX.XXX.XXX.XXX?"
		- odpoved obsahuje MAC adresu
		- cachovani - rezolucni tabulka, automaticka expirace zaznamu
	- dnes pouzivana pouze pro IPv4
- ATM
	- Asynchronous Transfer Mode
	- integrace ruznych datovych sluzeb (data, obraz, zvuk, telefonni sit)
	- umozneni vzniku spolecne infrastruktury pro vsechny typy datovych prenosu
	- koncove zarizeni - adapter (sitova karta), router, LAN switch, telefonni ustredna,...
	- ATM switch - spojeni kazdy s kazdym, implementace v HW
	- ATM adresy
		- 20 byte, obsahuje i 6 byte MAC adresy
		- univezalni cislovaci plan
	- virtualni okruhy
		- nejdrive se sestavi cesta (info ulozeno ve smerovacich), vsechna data jednoho spojeni prenasena okruhem, potom se cesta zrusi
		- hlavicka paketu obsahuje cislo virtualniho okruhu
		- smerovaci tabulka: `{ (link_in, vic_in), (link_out, vic_out)}`
	- paket
		- 5 byte header + 48 byte data
		- CELL - zakladni jednotka prenosu
			- v zahlavi oznaceni virtualni cesty (VC - virtual connection)
			- 48 bytu payload
	- sluzby:
		- CBR - Constant Bit Rate - vyhrazene pasmo, konstantni zpozdeni, emulace okruhu
		- VBR - Variable Bit Rate - speficifikovano maximalni pasmo, pro komprimovane prenosty
		- UBR - Unspecified Bit Rate - best efford, mozna ztrata bunec, datove prenosy
		- ABR - Available Bit Rate - prideli zbyle pasmo, male ztraty, rizeni toku dat
	- drive ambice, dnes telekomunikace a ADSL
- MPLS
	- MultiProtocol Label Switching
	- v OSI mezi L2 a L3
	- k paketum se pridava label
	- implementuje end-to-end spojeni nezavisle na linkove vrstve 
	- header
		- 32 bitu - label 20 bitu, traffic class 3 bity, bottom-of-stack 1 bit, TTL 8 bitu
	- hranicni router prideli label pri vstupu do MPLS => uvnitr site se paketu forwarduji podle labelu => pri vystupu z MPLS hranicni router odstrani label
	- 